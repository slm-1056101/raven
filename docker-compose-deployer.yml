services:
  suwokono-db:
    container_name: suwokono-db
    image: postgres:16
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-suwokono}
      POSTGRES_USER: ${POSTGRES_USER:-suwokono}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-suwokono}
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  suwokono-backend:
    container_name: suwokono-backend
    image: 534931273/suwokono-backend:v1.0.0
    environment:
      DJANGO_DEBUG: ${DJANGO_DEBUG:-1}
      DJANGO_SECRET_KEY: ${DJANGO_SECRET_KEY:-dev-insecure-change-me}
      DJANGO_ALLOWED_HOSTS: ${DJANGO_ALLOWED_HOSTS:-localhost,127.0.0.1,suwokono-backend}
      POSTGRES_HOST: suwokono-db
      POSTGRES_PORT: 5432
      POSTGRES_DB: ${POSTGRES_DB:-suwokono}
      POSTGRES_USER: ${POSTGRES_USER:-suwokono}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-suwokono}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS:-http://suwokono-frontend:5173}
    ports:
      - "8000:8000"
    depends_on:
      - suwokono-db
    # volumes:
    #   - ./backend:/app

  suwokono-frontend:
    container_name: suwokono-frontend
    image: 534931273/suwokono-frontend:v1.0.0
    working_dir: /app
    environment:
      VITE_API_PROXY_TARGET: http://suwokono-backend:8000
    ports:
      - "5173:5173"
    depends_on:
      - suwokono-backend
    # volumes:
    #   - ./frontend:/app
    #   - /app/node_modules
    # command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"

volumes:
  postgres_data:
